<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Spatial discretization · IncompressibleNavierStokes.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://agdestein.github.io/IncompressibleNavierStokes.jl/equations/spatial/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="IncompressibleNavierStokes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">IncompressibleNavierStokes.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../generated/LidDrivenCavity2D/">Tutorial: Lid-Driven Cavity (2D)</a></li><li><a class="tocitem" href="../../generated/Actuator2D/">Actuator (2D)</a></li><li><a class="tocitem" href="../../generated/BackwardFacingStep2D/">Backward Facing Step (2D)</a></li><li><a class="tocitem" href="../../generated/DecayingTurbulence2D/">Decaying Turbulunce (2D)</a></li><li><a class="tocitem" href="../../generated/PlanarMixing2D/">Planar Mixing (2D)</a></li><li><a class="tocitem" href="../../generated/ShearLayer2D/">Shear Layer (2D)</a></li></ul></li><li><span class="tocitem">Equations</span><ul><li><a class="tocitem" href="../ns/">Incompressible Navier-Stokes equations</a></li><li class="is-active"><a class="tocitem" href>Spatial discretization</a><ul class="internal"><li><a class="tocitem" href="#Interpolation"><span>Interpolation</span></a></li><li><a class="tocitem" href="#Differential-operators"><span>Differential operators</span></a></li><li><a class="tocitem" href="#Discretizing-the-Navier-Stokes-equations"><span>Discretizing the Navier-Stokes equations</span></a></li><li><a class="tocitem" href="#Boundary-conditions"><span>Boundary conditions</span></a></li><li><a class="tocitem" href="#Operator-formulation"><span>Operator formulation</span></a></li></ul></li><li><a class="tocitem" href="../time/">Time discretization</a></li></ul></li><li><span class="tocitem">Features</span><ul><li><a class="tocitem" href="../../features/precision/">Floating point precision</a></li><li><a class="tocitem" href="../../features/gpu/">GPU Support</a></li><li><a class="tocitem" href="../../features/les/">Large eddy simulation</a></li><li><a class="tocitem" href="../../features/pressure/">Pressure solvers</a></li><li><a class="tocitem" href="../../features/bc/">Boundary conditions</a></li><li><a class="tocitem" href="../../features/steppers/">Time steppers</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../api/api/">API</a></li><li><a class="tocitem" href="../../api/tableaux/">Runge-Kutta methods</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Equations</a></li><li class="is-active"><a href>Spatial discretization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Spatial discretization</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/main/docs/src/equations/spatial.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Spatial-Discretization"><a class="docs-heading-anchor" href="#Spatial-Discretization">Spatial Discretization</a><a id="Spatial-Discretization-1"></a><a class="docs-heading-anchor-permalink" href="#Spatial-Discretization" title="Permalink"></a></h1><p>To discretize the incompressible Navier-Stokes equations, we will use finite volumes on a staggered grid. This was originally proposed by Harlow and Welsh <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>. We will use the notation of Sanderse <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup> <sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup> <sup class="footnote-reference"><a id="citeref-4" href="#footnote-4">[4]</a></sup>. For simplicity, we will illustrate everything in 2D. The 3D discretization is very similar, but significantly more verbose.</p><p>The finite volumes are given by <span>$\Omega_{i, j} = [x_{i - \frac{1}{2}}, x_{i + \frac{1}{2}}] \times [y_{j - \frac{1}{2}}, y_{j + \frac{1}{2}}]$</span>. They are fully defined by the vectors of volume faces <span>$x = (x_{i + \frac{1}{2}})_i$</span> and <span>$y = (y_{j + \frac{1}{2}})_j$</span>. Note that the components are not assumed to be uniformly spaced. But we do assume that they are strictly increasing.</p><p>The volume center coordinates are deduced as <span>$x_i = \frac{1}{2} (x_{i - \frac{1}{2}} + x_{i + \frac{1}{2}})$</span> and <span>$y_j = \frac{1}{2} (y_{j - \frac{1}{2}} + y_{j + \frac{1}{2}})$</span>.</p><p>In each finite volume there are four different positions in which quantities of interest can be defined:</p><ul><li>The <span>$u$</span>-point <span>$(x_{i + \frac{1}{2}}, y_j)$</span>,</li><li>The <span>$v$</span>-point <span>$(x_i, y_{j + \frac{1}{2}})$</span>,</li><li>The <span>$p$</span>-point <span>$(x_i, y_j)$</span>,</li><li>The <span>$\omega$</span>-point <span>$(x_{i + \frac{1}{2}}, y_{j + \frac{1}{2}})$</span>.</li></ul><p>This configuration is illustrated as follows:</p><p><img src="../../assets/grid.png" alt="Grid"/></p><h2 id="Interpolation"><a class="docs-heading-anchor" href="#Interpolation">Interpolation</a><a id="Interpolation-1"></a><a class="docs-heading-anchor-permalink" href="#Interpolation" title="Permalink"></a></h2><p>The vectors of unknowns will not contain all the half-index values:</p><ul><li>The vector <span>$u_h$</span> will only consist of the components <span>$u_{i + \frac{1}{2}, j}$</span>.</li><li>The vector <span>$v_h$</span> will only consist of the components <span>$v_{i, j + \frac{1}{2}}$</span>.</li><li>The vector <span>$p_h$</span> will only consist of the components <span>$p_{i, j}$</span>.</li></ul><p>When components not contained in the vector of unknowns are needed to compute derivatives, we will use averaging to compute volume-center values (integer <span>$i$</span> and <span>$j$</span>), and interpolation to compute volume corner/face values (half-index for <span>$i$</span> and/or <span>$j$</span> respectively). Examples:</p><ul><li>To compute <span>$u$</span> at the pressure points: Averaging (interpolation simplifies)<p class="math-container">\[\begin{split}
    u_{i, j} &amp; =
    \frac{x_{i + \frac{1}{2}} - x_i}{x_{i + \frac{1}{2}} - x_{i - \frac{1}{2}}}
    u_{i - \frac{1}{2}, j}
    + \frac{x_i - x_{i - \frac{1}{2}}}{x_{i + \frac{1}{2}} - x_{i - \frac{1}{2}}}
    u_{i + \frac{1}{2}, j} \\
    &amp; = 
    \frac{1}{2} (u_{i - \frac{1}{2}, j} + u_{i + \frac{1}{2}, j})
\end{split}\]</p>Interpolation weights from volume faces to volume centers are always <span>$\frac{1}{2}$</span>.</li><li>To compute <span>$v$</span> at vorticity points: Interpolation<p class="math-container">\[v_{i + \frac{1}{2}, j + \frac{1}{2}} =
\frac{x_{i + 1} - x_{i + \frac{1}{2}}}{x_{i + 1} - x_i}
v_{i, j + \frac{1}{2}}
+ \frac{x_{i + \frac{1}{2}} - x_i}{x_{i + 1} - x_i}
v_{i + 1, j + \frac{1}{2}}\]</p></li><li>To compute <span>$p$</span> at <span>$v$</span>-points: Interpolation<p class="math-container">\[p_{i, j + \frac{1}{2}} =
\frac{y_{j + 1} - y_{j + \frac{1}{2}}}{y_{j + 1} - y_j}
p_{i, j}
+ \frac{y_{j + \frac{1}{2}} - y_j}{y_{j + 1} - y_j}
p_{i, j + 1}\]</p></li></ul><p>Note that the grid is allowed to be non-uniform, so the weights of interpolation from volume centers to volume faces may unequal and different from <span>$\frac{1}{2}$</span>.</p><h2 id="Differential-operators"><a class="docs-heading-anchor" href="#Differential-operators">Differential operators</a><a id="Differential-operators-1"></a><a class="docs-heading-anchor-permalink" href="#Differential-operators" title="Permalink"></a></h2><p>Consider a scalar field <span>$q$</span> defined at all the four points of each volume. The exact quantity <span>$\frac{\partial q}{\partial x}(x_i, y_j)$</span> is approximated by the difference <span>$q_{i, j}^x$</span> given by</p><p class="math-container">\[q_{i, j}^x =
\frac{q_{i + \frac{1}{2}, j} - q_{i -
\frac{1}{2}, j}}{x_{i + \frac{1}{2}} - x_{i - \frac{1}{2}}},\]</p><p>where <span>$i$</span> and <span>$j$</span> can take integer or half values. If <span>$q$</span> is not available at the required points, interpolation is performed <em>before</em> differentiation takes place.</p><p>Similarly, <span>$\frac{\partial q}{\partial y}(x_i, y_j)$</span> is always discretized as</p><p class="math-container">\[q_{i, j}^y = \frac{q_{i, j + \frac{1}{2}} - q_{i, j -
\frac{1}{2}}}{y_{j + \frac{1}{2}} - y_{j - \frac{1}{2}}}.\]</p><p>These central differences are second order accurate in <span>$(x_{i + \frac{1}{2}} - x_{i - \frac{1}{2}})$</span> and <span>$(y_{j + \frac{1}{2}} - y_{j - \frac{1}{2}})$</span> respectively.</p><p>The Laplace operator is obtained by applying each of the first order operators twice:</p><p class="math-container">\[q_{i, j}^{x x} =
\frac{q_{i + \frac{1}{2}, j}^x - q_{i -
\frac{1}{2}, j}^x}{x_{i + \frac{1}{2}} - x_{i - \frac{1}{2}}},\]</p><p>and</p><p class="math-container">\[q_{i, j}^{y y} = \frac{q_{i, j + \frac{1}{2}}^y - q_{i, j -
\frac{1}{2}}^y}{y_{j + \frac{1}{2}} - y_{j - \frac{1}{2}}}.\]</p><h2 id="Discretizing-the-Navier-Stokes-equations"><a class="docs-heading-anchor" href="#Discretizing-the-Navier-Stokes-equations">Discretizing the Navier-Stokes equations</a><a id="Discretizing-the-Navier-Stokes-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Discretizing-the-Navier-Stokes-equations" title="Permalink"></a></h2><p>We start by discretize the mass equation such that we have an exact definition for the discrete divergence freeness. The divergence operator defining this discrete equation is defined in the <span>$p$</span>-points. Using the above operators, this gives the following equation in each pressure point:</p><p class="math-container">\[\frac{u_{i + \frac{1}{2}, j} - u_{i - \frac{1}{2}, j}}{x_{i + \frac{1}{2}} -
x_{i - \frac{1}{2}}} +
\frac{v_{i, j + \frac{1}{2}} - v_{i, j - \frac{1}{2}}}{y_{j + \frac{1}{2}} -
y_{j - \frac{1}{2}}}
= 0\]</p><p>We then discretize the two momentum equations, making sure that</p><ul><li>the <span>$u$</span>-momentum equation is defined at the <span>$u$</span>-points,</li><li>the <span>$v$</span>-momentum equation is defined at the <span>$v$</span>-points.</li></ul><p>The discrete momentum equations thus have to be</p><p class="math-container">\[\begin{split}
    \frac{\mathrm{d} }{\mathrm{d} t} u_{i + \frac{1}{2}, j} + (u u)_{i +
    \frac{1}{2}, j}^x + (v u)_{i + \frac{1}{2}, j}^y &amp; = - p_{i + \frac{1}{2},
    j}^x + \nu \left( u_{i + \frac{1}{2}, j}^{x x} + u_{i + \frac{1}{2}, j}^{y y}
    \right) + f_u(x_{i + \frac{1}{2}}, y_j) \\
    \frac{\mathrm{d} }{\mathrm{d} t} v_{i, j + \frac{1}{2}} + (u v)_{i, j +
    \frac{1}{2}}^x + (v v)_{i, j + \frac{1}{2}}^y &amp; = - p_{i, j +
    \frac{1}{2}}^y + \nu \left( v_{i, j + \frac{1}{2}}^{x x} + v_{i, j +
    \frac{1}{2}}^{y y} \right) + f_v(x_i, y_{j + \frac{1}{2}}) \\
\end{split}\]</p><p>Instead of directly discretizing the continuous pressure Poisson equation, we will rededuce it in the <em>discrete</em> setting, thus aiming to preserve the discrete divergence freeness instead of the continuous one. Taking the discrete divergence of the to momentum equations yield the discrete pressure Poisson equation (defined at the <span>$p$</span>-points):</p><p class="math-container">\[- \left( p_{i, j}^{x x} + p_{i, j}^{y y} \right) = g_{i, j},\]</p><p>where <span>$g_{i, j}$</span> is all the discrete divergence of all the terms in the momentum equations except for the pressure. The time derivative terms dissapear due to the divergence freeness.</p><h2 id="Boundary-conditions"><a class="docs-heading-anchor" href="#Boundary-conditions">Boundary conditions</a><a id="Boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-conditions" title="Permalink"></a></h2><p>If a domain boundary is not periodic, the boundary values of certain quantities are prescribed. Consider the left boundary defined by <span>$i = \frac{1}{2}$</span>.</p><ul><li>For Dirichlet boundary conditions, we prescribe the value<p class="math-container">\[u_{\frac{1}{2}, j} =
\frac{1}{y_{j + \frac{1}{2}} - y_{j - \frac{1}{2}}}
\int_{y_{j - \frac{1}{2}}}^{y_{j + \frac{1}{2}}} u(x_{\frac{1}{2}}, y) \, \mathrm{d} y
\approx u(x_{\frac{1}{2}}, y_j)\]</p>if the cell height is small enough. For <span>$v$</span>, we also prescribe values, but only at the boundary, thus replacing otherwise interpolated <span>$v$</span>-fluxes:<p class="math-container">\[v_{\frac{1}{2}, j - \frac{1}{2}} \approx v(x_{\frac{1}{2}}, y_{j - \frac{1}{2}}).\]</p></li><li>For a symmetric left boundary, only <span>$u_{\frac{1}{2}, j}$</span> is prescribed.</li><li>For a pressure left boundary, we prescribe <span>$p$</span>:<p class="math-container">\[p_{1, j} \approx p(x_1, y_j).\]</p></li></ul><h2 id="Operator-formulation"><a class="docs-heading-anchor" href="#Operator-formulation">Operator formulation</a><a id="Operator-formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Operator-formulation" title="Permalink"></a></h2><p>The degres of freedom are stored in the two vectors <span>$V_h = (u_h, v_h)$</span> and <span>$p_h$</span>, but we do not include the degrees of freedom that are prescribed by a boundary condition. Instead, these values are moved to the right hand side of the equations.</p><p>In addition, we encode all discrete operators are as sparse matrices. The discrete mass equation is thus</p><p class="math-container">\[M V_h = y_M\]</p><p>where <span>$M$</span> is the discrete divergence operator and <span>$y_M$</span> are the boundary conditions for <span>$M$</span>.</p><p>The discretize momentum equations are given by</p><p class="math-container">\[\begin{split}
\Omega \frac{\mathrm{d} V_h}{\mathrm{d} t} &amp; = -C(V_h) V_h + \nu (D V_h +
y_D) + f_h - (G p_h + y_G) \\
&amp; = F(V_h) - (G p_h + y_G)
\end{split}\]</p><p>where <span>$\Omega = \operatorname{diag}(\Omega_u, \Omega_v)$</span> is a mass matrix containg the shifted volumes centered in the <span>$u$</span>-points and <span>$v$</span>-points, <span>$C(V_h)$</span> is a linear convection operator, <span>$D$</span> is a discrete diffusion operator, <span>$y_D$</span> are diffusion boundary conditions, <span>$f_h$</span> are the body forces, <span>$G = M^\mathsf{T}$</span> is the discrete gradient, and <span>$y_G$</span> are the pressure boundary conditions.</p><p>The discrete pressure Poisson equation is given by</p><p class="math-container">\[A p_h = g,\]</p><p>where <span>$A = -M \Omega^{-1} G$</span> is a Laplace operator and <span>$g = -M \Omega^{-1} (F(V_h) - y_G) + \frac{\mathrm{d}}{\mathrm{d} t} y_M$</span>.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a><a href="../../references/#Harlow1965">Francis H. Harlow, J. Eddie Welch (1965)</a></li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a><a href="../../references/#Sanderse2012">B. Sanderse, B. Koren (2012)</a></li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a><a href="../../references/#Sanderse2013">B. Sanderse (2013)</a></li><li class="footnote" id="footnote-4"><a class="tag is-link" href="#citeref-4">4</a><a href="../../references/#Sanderse2014">B. Sanderse, R.W.C.P. Verstappen, B. Koren (2014)</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ns/">« Incompressible Navier-Stokes equations</a><a class="docs-footer-nextpage" href="../time/">Time discretization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 10 July 2023 09:54">Monday 10 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
